Monocle={VERSION:"2.3.1"},Monocle.Dimensions={},Monocle.Controls={},Monocle.Flippers={},Monocle.Panels={},Monocle.Env=function(){function survey(e){surveyCallback=e,runNextTest()}function runNextTest(){var e=envTests.shift();if(!e)return completed();activeTestName=e[0];try{e[1]()}catch(t){result(t)}}function result(e){return API[activeTestName]=e,p.resultCallback&&p.resultCallback(activeTestName,e),runNextTest(),e}function completed(){Monocle.defer(removeTestFrame),"function"==typeof surveyCallback&&surveyCallback(API)}function testForFunction(str){return function(){result("function"==typeof eval(str))}}function testNotYetImplemented(e){return function(){result(e)}}function loadTestFrame(e,t){if(testFrame||(testFrame=createTestFrame()),frameLoadCallback=e,t=t||4,"number"==typeof t){for(var n=[],o=1,r=t;r>=o;++o)n.push("<div>Page "+o+"</div>");var i=["display:inline-block","line-height:"+testFrameSize+"px","width:"+testFrameSize+"px"].join(";");t='javascript:\'<!DOCTYPE html><html><head><meta name="time" content="'+(new Date).getTime()+'" />'+"<style>div{"+i+"}</style></head>"+"<body>"+n.join("")+"</body>"+"</html>'"}testFrame.src=t}function createTestFrame(){testFrameCntr=document.createElement("div"),testFrameCntr.style.cssText=["width:"+testFrameSize+"px","height:"+testFrameSize+"px","overflow:hidden","position:absolute","visibility:hidden"].join(";"),document.body.appendChild(testFrameCntr);var e=document.createElement("iframe");return testFrameCntr.appendChild(e),e.setAttribute("scrolling","no"),e.style.cssText=["width:100%","height:100%","border:none","background:#900"].join(";"),e.addEventListener("load",function(){if(e.contentDocument&&e.contentDocument.body){var t=e.contentDocument.body;t.style.cssText=["margin:0","padding:0","position:absolute","height:100%","width:100%","-webkit-column-width:"+testFrameSize+"px","-webkit-column-gap:0","-webkit-column-fill:auto","-moz-column-width:"+testFrameSize+"px","-moz-column-gap:0","-moz-column-fill:auto","-o-column-width:"+testFrameSize+"px","-o-column-gap:0","-o-column-fill:auto","column-width:"+testFrameSize+"px","column-gap:0","column-fill:auto"].join(";"),t.scrollHeight>testFrameSize&&(t.style.cssText+=["min-width:200%","overflow:hidden"].join(";"),t.className=t.scrollHeight<=testFrameSize?"column-force":"column-failed "+t.scrollHeight),frameLoadCallback(e)}},!1),e}function removeTestFrame(){testFrameCntr&&testFrameCntr.parentNode&&testFrameCntr.parentNode.removeChild(testFrameCntr)}function columnedWidth(e){var t=e.contentDocument.body,n=e.contentDocument.documentElement;return Math.max(t.scrollWidth,n.scrollWidth)}function isCompatible(){return API.supportsW3CEvents&&API.supportsCustomEvents&&API.supportsColumns&&API.supportsTransform&&!API.brokenIframeTouchModel}var API={constructor:Monocle.Env},k=API.constants=API.constructor,p=API.properties={resultCallback:null},css=Monocle.Browser.css,activeTestName=null,frameLoadCallback=null,testFrame=null,testFrameCntr=null,testFrameSize=100,surveyCallback=null,envTests=[["supportsW3CEvents",testForFunction("window.addEventListener")],["supportsCustomEvents",testForFunction("document.createEvent")],["supportsColumns",function(){result(css.supportsPropertyWithAnyPrefix("column-width"))}],["supportsTransform",function(){result(css.supportsProperty(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"]))}],["supportsTransition",function(){result(css.supportsPropertyWithAnyPrefix("transition"))}],["supportsXPath",testForFunction("document.evaluate")],["supportsQuerySelector",testForFunction("document.querySelector")],["supportsTransform3d",function(){result(css.supportsMediaQueryProperty("transform-3d")&&css.supportsProperty(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]))}],["supportsOfflineCache",function(){result("undefined"!=typeof window.applicationCache)}],["supportsLocalStorage",function(){result("undefined"!=typeof window.localStorage&&"function"==typeof window.localStorage.getItem)}],["touch",function(){result("ontouchstart"in window||css.supportsMediaQueryProperty("touch-enabled"))}],["embedded",function(){result(top!=self)}],["brokenIframeTouchModel",function(){result(Monocle.Browser.iOSVersionBelow("4.2"))}],["floatsIgnoreColumns",function(){return Monocle.Browser.is.WebKit?(match=navigator.userAgent.match(/AppleWebKit\/([\d\.]+)/),match?result(match[1]<"534.30"):result(!1)):result(!1)}],["widthsIgnoreTranslate",function(){loadTestFrame(function(e){for(var t=columnedWidth(e),n=e.contentDocument.body.style,o=css.toDOMProps("transform"),r=0,i=o.length;i>r;++r)n[o[r]]="translateX(-600px)";var a=columnedWidth(e);for(r=0,i=o.length;i>r;++r)n[o[r]]="none";result(a==t)})}],["relativeIframeExpands",function(){result(navigator.userAgent.indexOf("Android 2")>=0)}],["scrollToApplyStyle",function(){result(Monocle.Browser.iOSVersionBelow("4"))}],["forceColumns",function(){loadTestFrame(function(e){var t=e.contentDocument.body;result(t.className?!0:!1)})}],["findNodesByScrolling",function(){result("function"!=typeof document.body.getBoundingClientRect)}],["sheafIsScroller",function(){loadTestFrame(function(e){result(e.parentNode.scrollWidth>testFrameSize)})}],["stickySlideOut",function(){result(Monocle.Browser.is.MobileSafari)}],["roundPageDimensions",function(){result(!Monocle.Browser.is.IE)}],["documentElementHasScrollbars",function(){result(Monocle.Browser.is.IE)}],["offscreenRenderingClipped",function(){result(Monocle.Browser.iOSVersionBelow("6"))}]];return API.survey=survey,API.isCompatible=isCompatible,API},Monocle.CSS=function(){function e(e){var t=[e],n=l.engines.indexOf(Monocle.Browser.engine);if(n){var o=l.prefixes[n];o&&t.push(o+e)}return t}function t(t,n){for(var o=e(t),r=0,i=o.length;i>r;++r)o[r]+=": "+n+";";return o.join("")}function n(e){for(var t=e.split("-"),n=t.length;n>0;--n)t[n]=s(t[n]);var o=[t.join("")],r=l.engines.indexOf(Monocle.Browser.engine);if(r){var i=l.domprefixes[r];i&&(t[0]=s(t[0]),o.push(i+t.join("")))}return o}function o(e){for(var t in e)if(void 0!==u.guineapig.style[e[t]])return!0;return!1}function r(e){return o(n(e))}function i(e){var t="monocle_guineapig";u.guineapig.id=t;var n=document.createElement("style");n.textContent=e+"{#"+t+"{height:3px}}",(document.head||document.getElementsByTagName("head")[0]).appendChild(n),document.documentElement.appendChild(u.guineapig);var o=3===u.guineapig.offsetHeight;return n.parentNode.removeChild(n),u.guineapig.parentNode.removeChild(u.guineapig),o}function a(e){return i("@media ("+l.prefixes.join(e+"),(")+"monocle__)")}function s(e){return e?e.charAt(0).toUpperCase()+e.substr(1):""}var c={constructor:Monocle.CSS},l=c.constants=c.constructor,u=c.properties={guineapig:document.createElement("div")};return c.toCSSProps=e,c.toCSSDeclaration=t,c.toDOMProps=n,c.supportsProperty=o,c.supportsPropertyWithAnyPrefix=r,c.supportsMediaQuery=i,c.supportsMediaQueryProperty=a,c},Monocle.CSS.engines=["W3C","WebKit","Gecko","Opera","IE","Konqueror"],Monocle.CSS.prefixes=["","-webkit-","-moz-","-o-","-ms-","-khtml-"],Monocle.CSS.domprefixes=["","Webkit","Moz","O","ms","Khtml"],"undefined"==typeof window.console&&(window.console={messages:[]},window.console.log=function(e){this.messages.push(e)},window.console.warn=window.console.log),window.console.compatDir=function(e){var t=function(e){var t=[];for(x in e)t.push(x+": "+e[x]);return t.join(";\n")},n=t(e);return window.console.log(n),n},window.console.deprecation=function(e){console.warn("[DEPRECATION]: "+e),"function"==typeof console.trace&&console.trace()},Monocle.defer=function(e,t){return e&&"function"==typeof e?setTimeout(e,t||0):void 0},Monocle.Browser={},Monocle.Browser.uaMatch=function(e){var t=navigator.userAgent;return"string"==typeof e?t.indexOf(e)>=0:!!t.match(e)},Monocle.Browser.is={IE:!(!window.attachEvent||Monocle.Browser.uaMatch("Opera")),Opera:Monocle.Browser.uaMatch("Opera"),WebKit:Monocle.Browser.uaMatch(/Apple\s?WebKit/),Gecko:Monocle.Browser.uaMatch("Gecko")&&!Monocle.Browser.uaMatch("KHTML"),MobileSafari:Monocle.Browser.uaMatch(/AppleWebKit.*Mobile/)},Monocle.Browser.is.IE?Monocle.Browser.engine="IE":Monocle.Browser.is.Opera?Monocle.Browser.engine="Opera":Monocle.Browser.is.WebKit?Monocle.Browser.engine="WebKit":Monocle.Browser.is.Gecko?Monocle.Browser.engine="Gecko":(console.warn("Unknown engine; assuming W3C compliant."),Monocle.Browser.engine="W3C"),Monocle.Browser.on={iPhone:Monocle.Browser.is.MobileSafari&&320==screen.width,iPad:Monocle.Browser.is.MobileSafari&&768==screen.width,UIWebView:Monocle.Browser.is.MobileSafari&&!Monocle.Browser.uaMatch("Safari")&&!navigator.standalone,BlackBerry:Monocle.Browser.uaMatch("BlackBerry"),Android:Monocle.Browser.uaMatch("Android")||Monocle.Browser.uaMatch(/Linux;.*EBRD/),MacOSX:Monocle.Browser.uaMatch("Mac OS X")&&!Monocle.Browser.is.MobileSafari,Kindle3:Monocle.Browser.uaMatch(/Kindle\/3/)},Monocle.Browser.is.MobileSafari&&!function(){var e=navigator.userAgent.match(/ OS ([\d_]+)/);e?Monocle.Browser.iOSVersion=e[1].replace(/_/g,"."):console.warn("Unknown MobileSafari user agent: "+navigator.userAgent)}(),Monocle.Browser.iOSVersionBelow=function(e){return!!Monocle.Browser.iOSVersion&&Monocle.Browser.iOSVersion<e},Monocle.Browser.renders={eInk:Monocle.Browser.on.Kindle3,slow:Monocle.Browser.on.Android||Monocle.Browser.on.Blackberry},Monocle.Browser.css=new Monocle.CSS,Monocle.Browser.survey=function(e){Monocle.Browser.env?"function"==typeof e&&e():(Monocle.Browser.env=new Monocle.Env,Monocle.Browser.env.survey(e))},Monocle.bookData=function(e){return{getComponents:function(){return e.components||["anonymous"]},getContents:function(){return e.chapters||[]},getComponent:e.getComponent||function(e){return{url:e}},getMetaData:function(t){return(e.metadata||{})[t]},data:e}},Monocle.bookDataFromIds=function(e){return Monocle.bookData({components:e,getComponent:function(e){return{nodes:[document.getElementById(e)]}}})},Monocle.bookDataFromNodes=function(e){return Monocle.bookData({getComponent:function(){return{nodes:e}}})},Monocle.Factory=function(e,t,n,o){function r(){if(g.label){var e=g.reader.properties.graph;if(e[g.label]=e[g.label]||[],"undefined"==typeof g.index&&e[g.label][g.index])throw"Element already exists in graph: "+g.label+"["+g.index+"]";g.index=g.index||e[g.label].length,e[g.label][g.index]=g.element,p(g.label)}}function i(e,t){return g.reader.properties.graph[e]?g.reader.properties.graph[e][t||0]:null}function a(e,t,n){return e.dom=new Monocle.Factory(e,t,n,g.reader)}function s(e,t){var n,o;if(1==arguments.length)t=null,n=0,o={};else if(2==arguments.length)n=0,o={};else if(4==arguments.length)n=arguments[2],o=arguments[3];else if(3==arguments.length){var r=arguments[arguments.length-1];"number"==typeof r?(n=r,o={}):(n=0,o=r)}var i=document.createElement(e);return a(i,t,n),o["class"]&&(i.className+=" "+g.prefix+o["class"]),o.html&&(i.innerHTML=o.html),o.text&&i.appendChild(document.createTextNode(o.text)),i}function c(){var e=s.apply(this,arguments);return g.element.appendChild(e),e}function l(){return[g.label,g.index,g.reader]}function u(e){return Monocle.Styles.applyRules(g.element,e)}function d(e,t){return Monocle.Styles.affix(g.element,e,t)}function f(e){e=g.prefix+e;var t=g.element.className;return t?t==e?!0:new RegExp("(^|\\s)"+e+"(\\s|$)").test(t):!1}function p(e){if(!f(e)){var t=g.element.className?" ":"";return g.element.className+=t+g.prefix+e}}function h(e){var t=new RegExp("(^|\\s+)"+g.prefix+e+"(\\s+|$)"),n=/^\s+|\s+$/g,o=g.element.className;return g.element.className=o.replace(t," ").replace(n,""),g.element.className}var m={constructor:Monocle.Factory};m.constants=m.constructor;var g=m.properties={element:e,label:t,index:n,reader:o,prefix:o.properties.classPrefix||""};return m.find=i,m.claim=a,m.make=s,m.append=c,m.address=l,m.setStyles=u,m.setBetaStyle=d,m.hasClass=f,m.addClass=p,m.removeClass=h,r(),m},Monocle.Events={},Monocle.Events.dispatch=function(e,t,n,o){if(!document.createEvent)return!0;var r=document.createEvent("Events");r.initEvent(t,!1,o||!1),r.m=n;try{return e.dispatchEvent(r)}catch(i){return console.warn("Failed to dispatch event: "+t),!1}},Monocle.Events.listen=function(e,t,n,o){return"string"==typeof e&&(e=document.getElementById(e)),e.addEventListener(t,n,o||!1)},Monocle.Events.deafen=function(e,t,n,o){return"string"==typeof e&&(e=document.getElementById(e)),e.removeEventListener(t,n,o||!1)},Monocle.Events.listenForContact=function(e,t,n){var o={},r=function(e,t){e.m={pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY};for(var n=e.target||e.srcElement;1!=n.nodeType&&n.parentNode;)n=n.parentNode;var o=i(e,n);return e.m.offsetX=o[0],e.m.offsetY=o[1],e.currentTarget&&"undefined"!=typeof e.currentTarget.offsetLeft&&(o=i(e,e.currentTarget),e.m.registrantX=o[0],e.m.registrantY=o[1]),e},i=function(e,t){var n;if(t.getBoundingClientRect){var o=document.documentElement.getBoundingClientRect(),r=t.getBoundingClientRect();n={left:r.left-o.left,top:r.top-o.top}}else for(n={left:t.offsetLeft,top:t.offsetTop};t=t.offsetParent;)(t.offsetLeft||t.offsetTop)&&(n.left+=t.offsetLeft,n.top+=t.offsetTop);return[e.m.pageX-n.left,e.m.pageY-n.top]},a=n&&n.useCapture||!1;if(Monocle.Browser.env.touch){t.start&&(o.touchstart=function(e){e.touches.length>1||t.start(r(e,e.targetTouches[0]))}),t.move&&(o.touchmove=function(e){e.touches.length>1||t.move(r(e,e.targetTouches[0]))}),t.end&&(o.touchend=function(e){t.end(r(e,e.changedTouches[0]))}),t.cancel&&(o.touchcancel=function(e){t.cancel(r(e,e.changedTouches[0]))});for(etype in o)Monocle.Events.listen(e,etype,o[etype],a)}else t.start&&(o.mousedown=function(e){0==e.button&&t.start(r(e,e))},Monocle.Events.listen(e,"mousedown",o.mousedown,a)),t.move&&(o.mousemove=function(e){t.move(r(e,e))},Monocle.Events.listen(e,"mousemove",o.mousemove,a)),t.end&&(o.mouseup=function(e){t.end(r(e,e))},Monocle.Events.listen(e,"mouseup",o.mouseup,a)),t.cancel&&(o.mouseout=function(n){for(obj=n.relatedTarget||n.fromElement;obj&&(obj=obj.parentNode);)if(obj==e)return;t.cancel(r(n,n))},Monocle.Events.listen(e,"mouseout",o.mouseout,a));return o},Monocle.Events.deafenForContact=function(e,t){for(evtType in t)Monocle.Events.deafen(e,evtType,t[evtType])},Monocle.Events.listenForTap=function(e,t,n){var o,r;Monocle.Browser.on.Kindle3&&Monocle.Events.listen(e,"click",function(){});var i=function(){o=null,n&&e.dom&&e.dom.removeClass(n)},a=function(t){if(o&&!(t.type.match(/^mouse/)||Monocle.Browser.is.MobileSafari&&Monocle.Browser.iOSVersion<"3.2")){if(r&&!n){var a=e.getBoundingClientRect();(a.left!=r.left||a.top!=r.top)&&i()}(t.m.registrantX<0||t.m.registrantX>e.offsetWidth||t.m.registrantY<0||t.m.registrantY>e.offsetHeight)&&i()}};return Monocle.Events.listenForContact(e,{start:function(t){o=[t.m.pageX,t.m.pageY],e.getBoundingClientRect&&(r=e.getBoundingClientRect()),n&&e.dom&&e.dom.addClass(n)},move:a,end:function(e){a(e),o&&(e.m.pageXStart=o[0],e.m.pageYStart=o[1],t(e)),i()},cancel:i},{useCapture:!1})},Monocle.Events.deafenForTap=Monocle.Events.deafenForContact,Monocle.Events.afterTransition=function(e,t){var n="transitionend";Monocle.Browser.is.WebKit?n="webkitTransitionEnd":Monocle.Browser.is.Opera&&(n="oTransitionEnd");var o=null,r=null;return o=function(){t(),r()},r=function(){Monocle.Events.deafen(e,n,o)},Monocle.Events.listen(e,n,o),r},Monocle.Styles={rulesToString:function(e){if("string"!=typeof e){var t=[];for(var n in e)t.push(n+": "+e[n]+";");e=t.join(" ")}return e},applyRules:function(e,t){return t=Monocle.Styles.rulesToString(t),e.style.cssText+=";"+t,e.style.cssText},affix:function(e,t,n){for(var o=e.style?e.style:e,r=Monocle.Browser.css.toDOMProps(t);r.length;)o[r.shift()]=n},setX:function(e,t){var n=e.style;return"number"==typeof t&&(t+="px"),n.webkitTransform=Monocle.Browser.env.supportsTransform3d?"translate3d("+t+", 0, 0)":"translateX("+t+")",n.MozTransform=n.OTransform=n.transform="translateX("+t+")",t},setY:function(e,t){var n=e.style;return"number"==typeof t&&(t+="px"),n.webkitTransform=Monocle.Browser.env.supportsTransform3d?"translate3d(0, "+t+", 0)":"translateY("+t+")",n.MozTransform=n.OTransform=n.transform="translateY("+t+")",t},getX:function(e){for(var t=document.defaultView.getComputedStyle(e,null),n=/matrix\([^,]+,[^,]+,[^,]+,[^,]+,\s*([^,]+),[^\)]+\)/,o=Monocle.Browser.css.toDOMProps("transform"),r=null;o.length&&!r;)r=t[o.shift()];return parseInt(r.match(n)[1])},transitionFor:function(e,t,n,o,r){var i=Monocle.Browser.css.toDOMProps("transition"),a=Monocle.Browser.css.toCSSProps(t);o=o||"linear",r=(r||0)+"ms";for(var s=0,c=i.length;c>s;++s){var l="none";n&&(l=[a[s],n+"ms",o,r].join(" ")),e.style[i[s]]=l}}},Monocle.Styles.container={position:"absolute",overflow:"hidden",top:"0",left:"0",bottom:"0",right:"0"},Monocle.Styles.page={position:"absolute","z-index":"1","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none","-webkit-transform":"translate3d(0,0,0)",visibility:"visible"},Monocle.Styles.sheaf={position:"absolute",overflow:"hidden"},Monocle.Styles.component={width:"100%",height:"100%",border:"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},Monocle.Styles.control={"z-index":"100",cursor:"pointer"},Monocle.Styles.overlay={position:"absolute",display:"none",width:"100%",height:"100%","z-index":"1000"},Monocle.Formatting=function(e,t,n){function o(){w.fontScale=n,r(t),w.reader.listen("monocle:componentmodify",i)}function r(e){var t=y.DEFAULT_STYLE_RULES;Monocle.Browser.env.floatsIgnoreColumns&&t.push("html#RS\\:monocle * { float: none !important; }"),w.defaultStyles=a(t,!1),e&&(w.initialStyles=a(e,!1))}function i(e){var t=e.m.document;t.documentElement.id=w.reader.properties.systemId,h(t,w.fontScale);for(var n=0;n<w.stylesheets.length;++n)w.stylesheets[n]&&f(t,n)}function a(e,t){return l(function(){w.stylesheets.push(e);for(var t=w.stylesheets.length-1,n=0,o=null;o=w.reader.dom.find("component",n++);)f(o.contentDocument,t);return t},t)}function s(e,t,n){return l(function(){w.stylesheets[e]=t,"function"==typeof t.join&&(t=t.join("\n"));for(var n=0,o=null;o=w.reader.dom.find("component",n++);){var r=o.contentDocument,i=r.getElementById("monStylesheet"+e);if(!i)return console.warn("No such stylesheet: "+e),void 0;i.styleSheet?i.styleSheet.cssText=t:i.replaceChild(r.createTextNode(t),i.firstChild)}},n)}function c(e,t){return l(function(){w.stylesheets[e]=null;for(var t=0,n=null;n=w.reader.dom.find("component",t++);){var o=n.contentDocument,r=o.getElementById("monStylesheet"+e);r.parentNode.removeChild(r)}},t)}function l(e,t){t=t===!1?!1:!0,t&&u();var n=e();return t?(w.reader.recalculateDimensions(!0),Monocle.defer(d)):w.reader.recalculateDimensions(!1),n}function u(){w.reader.dispatchEvent("monocle:stylesheetchanging",{})}function d(){w.reader.dispatchEvent("monocle:stylesheetchange",{})}function f(e,t){var n=w.stylesheets[t];if(n&&e&&e.documentElement){var o=e.getElementsByTagName("head")[0];o||(o=e.createElement("head"),e.documentElement.appendChild(o)),"function"==typeof n.join&&(n=n.join("\n"));var r=e.createElement("style");return r.type="text/css",r.id="monStylesheet"+t,r.styleSheet?r.styleSheet.cssText=n:r.appendChild(e.createTextNode(n)),o.appendChild(r),r}}function p(e,t){w.fontScale=e,t&&u();for(var n=0,o=null;o=w.reader.dom.find("component",n++);)h(o.contentDocument,e);t?(w.reader.recalculateDimensions(!0),d()):w.reader.recalculateDimensions(!1)}function h(e,t){var n=e.getElementsByTagName("*");if(t){t=parseFloat(t),e.pfsSwept||m(e,n);for(var o=0,r=n.length;r>o;++o){var i=g(n[o].pfsOriginal,t);n[o].pfsApplied?v(n[o],i):n[o].style.cssText+=i,n[o].pfsApplied=t}}else if(e.pfsSwept){for(var o=0,r=n.length;r>o;++o)if(n[o].pfsApplied){var a=n[o].pfsOriginalProp,s=a?"font-size: "+a+" ! important;":"";v(n[o],s),n[o].pfsApplied=null}m(e,n)}}function m(e,t){for(var n=0,o=t.length;o>n;++n){var r=e.defaultView.getComputedStyle(t[n],null),i=parseFloat(r.getPropertyValue("font-size"));t[n].pfsOriginal=i,t[n].pfsOriginalProp=t[n].style.fontSize}e.pfsSwept=!0}function g(e,t){return"font-size: "+e*t+"px ! important;"}function v(e,t){var n=/font-size:[^;]/;e.style.cssText=e.style.cssText.replace(n,t)}var b={constructor:Monocle.Formatting},y=b.constants=b.constructor,w=b.properties={reader:e,stylesheets:[],fontScale:null};return b.addPageStyles=a,b.updatePageStyles=s,b.removePageStyles=c,b.setFontScale=p,o(),b},Monocle.Formatting.DEFAULT_STYLE_RULES=["html#RS\\:monocle * {-webkit-font-smoothing: subpixel-antialiased;text-rendering: auto !important;word-wrap: break-word !important;overflow: visible !important;}","html#RS\\:monocle body {margin: 0 !important;border: none !important;padding: 0 !important;width: 100% !important;position: absolute !important;-webkit-text-size-adjust: none;}","html#RS\\:monocle body * {max-width: 100% !important;}","html#RS\\:monocle img, html#RS\\:monocle video, html#RS\\:monocle object {max-height: 95% !important;height: auto !important;}"],Monocle.Reader=function(e,t,n,o){function r(){n=n||{},Monocle.Browser.survey(i)}function i(){var r=e;if("string"==typeof r&&(r=document.getElementById(r)),L=B.dom=r.dom=new Monocle.Factory(r,"box",0,B),B.billboard=new Monocle.Billboard(B),!Monocle.Browser.env.isCompatible())return C("monocle:incompatible",{},!0)&&B.billboard.show(O.SUPPORT_URL,{closeButton:!1}),void 0;C("monocle:initializing",B),t=t||Monocle.bookDataFromNodes([r.cloneNode(!0)]);var i=new Monocle.Book(t,n.preloadWindow||1);r.innerHTML="",a(),s(n.flipper),c(),B.selection=new Monocle.Selection(B),B.formatting=new Monocle.Formatting(B,n.stylesheet,n.fontScale),l(n.primeURL,function(){u(),R.flipper.listenForInteraction(n.panels),p(i,n.place,function(){R.initialized=!0,o&&o(B),C("monocle:loaded",B)})})}function a(){var e,t=L.find("box");if(document.defaultView){var n=document.defaultView.getComputedStyle(t,null);e=n.getPropertyValue("position")}else t.currentStyle&&(e=t.currentStyle.position);-1==["absolute","relative"].indexOf(e)&&(t.style.position="relative")}function s(e){e||(e=Monocle.Browser.renders.eInk||Monocle.Browser.renders.slow?Monocle.Flippers.Instant:Monocle.Flippers.Slider),R.flipper=new e(B,null,R.readerOptions)}function c(){for(var e=L.append("div","container"),t=0;t<R.flipper.pageCount;++t){var n=e.dom.append("div","page",t);n.style.visibility="hidden",n.m={reader:B,pageIndex:t,place:null},n.m.sheafDiv=n.dom.append("div","sheaf",t),n.m.activeFrame=n.m.sheafDiv.dom.append("iframe","component",t),n.m.activeFrame.m={pageDiv:n},n.m.activeFrame.setAttribute("frameBorder",0),n.m.activeFrame.setAttribute("scrolling","no"),R.flipper.addPage(n)}L.append("div","overlay"),C("monocle:loading",B)}function l(e,t){e=e||(Monocle.Browser.on.UIWebView?"blank.html":"about:blank");var n=0,o=function(e){var r=e.target||e.srcElement;Monocle.Events.deafen(r,"load",o),C("monocle:frameprimed",{frame:r,pageIndex:n}),(n+=1)==R.flipper.pageCount&&Monocle.defer(t)};A(function(t){Monocle.Events.listen(t.m.activeFrame,"load",o),t.m.activeFrame.src=e})}function u(){L.find("container").dom.setStyles(Monocle.Styles.container),A(function(e,t){e.dom.setStyles(Monocle.Styles.page),L.find("sheaf",t).dom.setStyles(Monocle.Styles.sheaf);var n=L.find("component",t);n.dom.setStyles(Monocle.Styles.component)}),f(),L.find("overlay").dom.setStyles(Monocle.Styles.overlay),C("monocle:styles")}function d(){if(Monocle.Browser.env.relativeIframeExpands)for(var e,t=0;e=L.find("component",t);++t)e.style.display="none"}function f(){if(Monocle.Browser.env.relativeIframeExpands)for(var e,t=0;e=L.find("component",t);++t)e.style.width=e.parentNode.offsetWidth+"px",e.style.display="block"}function p(e,t,n){R.book=e;var o=0;if("function"==typeof n){var r={"monocle:componentchange":function(e){return C("monocle:firstcomponentchange",e.m),(o+=1)==R.flipper.pageCount},"monocle:turn":function(){return n(),!0}},i=function(e){r[e.type](e)&&F(e.type,i)};for(evtType in r)T(evtType,i)}R.flipper.moveTo(t||{page:1})}function h(){return R.book}function m(){R.initialized||console.warn("Attempt to resize book before initialization."),d(),C("monocle:resizing",{},!0)&&(clearTimeout(R.resizeTimer),R.resizeTimer=setTimeout(function(){f(),g(!0),C("monocle:resize")},O.RESIZE_DELAY))}function g(e){if(R.book){C("monocle:recalculating");var t,n;if(e!==!1)var t=v(),n={percent:t?t.percentageThrough():0};A(function(e){e.m.activeFrame.m.component.updateDimensions(e)}),Monocle.defer(function(){n&&R.flipper.moveTo(n),C("monocle:recalculated")})}}function v(e){return R.initialized||console.warn("Attempt to access place before initialization."),R.flipper.getPlace(e)}function b(e,t){if(R.initialized||console.warn("Attempt to move place before initialization."),!R.book.isValidLocus(e))return C("monocle:notfound",{href:e?e.componentId:"anonymous"}),!1;var n=t;return e.direction||(C("monocle:jumping",{locus:e}),n=function(){C("monocle:jump",{locus:e}),t&&t()}),R.flipper.moveTo(e,n),!0}function y(e){var t=R.book.locusOfChapter(e);return b(t)}function w(e,t,n){for(var o=0;o<R.controls.length;++o)if(R.controls[o].control==e)return console.warn("Already added control: %o",e),void 0;n=n||{};var r={control:e,elements:[],controlType:t};R.controls.push(r);var i,a=L.find("container"),s=L.find("overlay");t&&"standard"!=t?"page"==t?A(function(t){var n=e.createControlElements(t);t.appendChild(n),r.elements.push(n)}):"modal"==t||"popover"==t||"hud"==t?(i=e.createControlElements(s),s.appendChild(i),r.elements.push(i),r.usesOverlay=!0):"invisible"==t?"function"==typeof e.createControlElements&&(i=e.createControlElements(a))&&(a.appendChild(i),r.elements.push(i)):console.warn("Unknown control type: "+t):(i=e.createControlElements(a),a.appendChild(i),r.elements.push(i));for(var o=0;o<r.elements.length;++o)Monocle.Styles.applyRules(r.elements[o],Monocle.Styles.control);return n.hidden?S(e):k(e),"function"==typeof e.assignToReader&&e.assignToReader(B),e}function M(e){for(var t=0;t<R.controls.length;++t)if(R.controls[t].control==e)return R.controls[t]}function S(e){var t=M(e);if(!t)return console.warn("No data for control: "+e),void 0;if(!t.hidden){for(var n=0;n<t.elements.length;++n)t.elements[n].style.display="none";if(t.usesOverlay){var o=L.find("overlay");o.style.display="none",Monocle.Events.deafenForContact(o,o.listeners),"hud"!=t.controlType&&C("monocle:modal:off")}t.hidden=!0,e.properties&&(e.properties.hidden=!0),C("monocle:controlhide",{control:e},!1)}}function k(e){var t=M(e);if(!t)return console.warn("No data for control: "+e),!1;if(E(e))return!1;var n=L.find("overlay");if(t.usesOverlay&&"hud"!=t.controlType){for(var o=0,r=R.controls.length;r>o;++o)if(R.controls[o].usesOverlay&&!R.controls[o].hidden)return!1;n.style.display="block",C("monocle:modal:on")}for(var o=0;o<t.elements.length;++o)t.elements[o].style.display="block";if("popover"==t.controlType){var i=function(e){var n=e.target;do if(n==t.elements[0])return!0;while(n&&(n=n.parentNode));return!1};n.listeners=Monocle.Events.listenForContact(n,{start:function(t){i(t)||S(e)},move:function(e){i(e)||e.preventDefault()}})}return t.hidden=!1,e.properties&&(e.properties.hidden=!1),C("monocle:controlshow",{control:e},!1),!0}function E(e){var t=M(e);return 0==t.hidden}function C(e,t,n){return Monocle.Events.dispatch(L.find("box"),e,t,n)}function T(e,t,n){Monocle.Events.listen(L.find("box"),e,t,n)}function F(e,t){Monocle.Events.deafen(L.find("box"),e,t)}function x(){return R.flipper.visiblePages?R.flipper.visiblePages():[L.find("page")]}function A(e){for(var t=0,n=R.flipper.pageCount;n>t;++t){var o=L.find("page",t);e(o,t)}}function P(e,t){return console.deprecation("Use reader.formatting.addPageStyles instead."),B.formatting.addPageStyles(e,t)}function D(e,t,n){return console.deprecation("Use reader.formatting.updatePageStyles instead."),B.formatting.updatePageStyles(e,t,n)}function I(e,t){return console.deprecation("Use reader.formatting.removePageStyles instead."),B.formatting.removePageStyles(e,t)}var L,B={constructor:Monocle.Reader},O=B.constants=B.constructor,R=B.properties={initialized:!1,book:null,graph:{},systemId:(n?n.systemId:null)||O.DEFAULT_SYSTEM_ID,classPrefix:O.DEFAULT_CLASS_PREFIX,controls:[],resizeTimer:null};return B.getBook=h,B.getPlace=v,B.moveTo=b,B.skipToChapter=y,B.resized=m,B.recalculateDimensions=g,B.addControl=w,B.hideControl=S,B.showControl=k,B.showingControl=E,B.dispatchEvent=C,B.listen=T,B.deafen=F,B.visiblePages=x,B.addPageStyles=P,B.updatePageStyles=D,B.removePageStyles=I,r(),B},Monocle.Reader.SUPPORT_URL="http://unsupported.monoclejs.com",Monocle.Reader.RESIZE_DELAY=100,Monocle.Reader.DEFAULT_SYSTEM_ID="RS:monocle",Monocle.Reader.DEFAULT_CLASS_PREFIX="monelem_",Monocle.Reader.DEFAULT_STYLE_RULES=Monocle.Formatting.DEFAULT_STYLE_RULES,Monocle.Book=function(e,t){function n(){y.componentIds=e.getComponents(),y.contents=e.getContents(),y.lastCIndex=y.componentIds.length-1}function o(e,t){t.load=!1;var n=e.m.activeFrame?e.m.activeFrame.m.component:null,o=null,r=y.componentIds.indexOf(t.componentId);if(0>r&&!n)return t.load=!0,t.componentId=y.componentIds[0],t;if(0>r&&t.componentId&&n.properties.id!=t.componentId)return e.m.reader.dispatchEvent("monocle:notfound",{href:t.componentId}),null;if(0>r)o=n,t.componentId=e.m.activeFrame.m.component.properties.id,r=y.componentIds.indexOf(t.componentId);else{if(!y.components[r]||y.components[r]!=n)return t.load=!0,t;o=n}var i={load:!1,componentId:t.componentId,page:1};if(lastPageNum=o.lastPageNumber(),"number"==typeof t.page)i.page=t.page;else if("number"==typeof t.pagesBack)i.page=lastPageNum+t.pagesBack;else if("number"==typeof t.percent){var a=new Monocle.Place;a.setPlace(o,1),i.page=a.pageAtPercentageThrough(t.percent)}else"number"==typeof t.direction?(e.m.place||console.warn("Can't move in a direction if pageDiv has no place."),i.page=e.m.place.pageNumber(),i.page+=t.direction):"string"==typeof t.anchor?i.page=o.pageForChapter(t.anchor,e):"string"==typeof t.xpath?i.page=o.pageForXPath(t.xpath,e):"string"==typeof t.selector?i.page=o.pageForSelector(t.selector,e):"string"==typeof t.position?"start"==t.position?i.page=1:"end"==t.position&&(i.page=lastPageNum["new"]):console.warn("Unrecognised locus: "+t);return i.page<1?0==r?(i.page=1,i.boundarystart=!0):(i.load=!0,i.componentId=y.componentIds[r-1],i.pagesBack=i.page,i.page=null):i.page>lastPageNum&&(r==y.lastCIndex?(i.page=lastPageNum,i.boundaryend=!0):(i.load=!0,i.componentId=y.componentIds[r+1],i.page-=lastPageNum)),i}function r(e,t){if(t=o(e,t),t&&!t.load){var n={locus:t,page:e};if(t.boundarystart)e.m.reader.dispatchEvent("monocle:boundarystart",n);else if(t.boundaryend)e.m.reader.dispatchEvent("monocle:boundaryend",n);else{var r=y.components[y.componentIds.indexOf(t.componentId)];e.m.place=e.m.place||new Monocle.Place,e.m.place.setPlace(r,t.page);var n={page:e,locus:t,pageNumber:e.m.place.pageNumber(),componentId:t.componentId};e.m.reader.dispatchEvent("monocle:pagechange",n)}}return t}function i(e,t,n,a){var c=y.componentIds.indexOf(t.componentId);if((!t.load||0>c)&&(t=o(e,t)),t){if(!t.load)return n(t),void 0;var u=function(){t=r(e,t),t&&(t.load?i(e,t,n,a):n(t))},d=function(){a?a(u):u()},f=function(t){t.applyTo(e,d);for(var n=1;n<=y.preloadWindow;++n)l(c+n,n*b.PRELOAD_INTERVAL)},p=function(e){a?a(function(){f(e)}):f(e)};s(c,p,e)}}function a(e,t,n,o,a){t=r(e,t),t?t.load?i(e,t,n,o):n(t):a&&a()}function s(e,t,n){if(y.components[e])return t(y.components[e]);var o=y.components[e],r={page:n,component:o,index:e};n.m.reader.dispatchEvent("monocle:componentloading",r);var i=function(e){r.component=e,n.m.reader.dispatchEvent("monocle:componentloaded",r),t(e)},a=function(){console.warn("Failed to load component: "+o),n.m.reader.dispatchEvent("monocle:componentfailed",r);try{var e=n.m.activeFrame.m.component;r.cmptId=e.properties.id,t(e)}catch(i){console.warn("Failed to fall back to previous component.")}};u(e,i,a)}function c(e){if(!y.components[e]){var t=y.componentIds[e];t&&(y.cmptLoadQueue[t]||u(e))}}function l(e,t){Monocle.defer(function(){c(e)
},t)}function u(e,t,n){var o=y.componentIds[e],r={success:t,failure:n};if(y.cmptLoadQueue[o])return y.cmptLoadQueue[o]=r;y.cmptLoadQueue[o]=r;var i=function(){d(o,"failure")},a=function(t){return t===!1?i():(y.components[e]=new Monocle.Component(v,o,e,f(o),t),d(o,"success",y.components[e]),void 0)},s=y.dataSource.getComponent(o,a);s&&!y.components[e]?a(s):s===!1&&i()}function d(e,t,n){"function"==typeof y.cmptLoadQueue[e][t]&&y.cmptLoadQueue[e][t](n),y.cmptLoadQueue[e]=null}function f(e){if(y.chapters[e])return y.chapters[e];y.chapters[e]=[];for(var t,n=new RegExp("^"+decodeURIComponent(e)+"(#(.+)|$)"),o=function(r){if((t=decodeURIComponent(r.src).match(n))&&y.chapters[e].push({title:r.title,fragment:t[2]||null}),r.children)for(var i=0;i<r.children.length;++i)o(r.children[i])},r=0;r<y.contents.length;++r)o(y.contents[r]);return y.chapters[e]}function p(e){var t=new RegExp("^(.+?)(#(.*))?$"),n=e.match(t);if(!n)return null;var o=m(n[1]);if(!o)return null;var r={componentId:o};return n[3]?r.anchor=n[3]:r.position="start",r}function h(e){return e?e.componentId&&!m(e.componentId)?!1:!0:!1}function m(e){e=decodeURIComponent(e);for(var t=0,n=y.componentIds.length;n>t;++t)if(decodeURIComponent(y.componentIds[t])==e)return e;return null}function g(){if(!y.weights&&(y.weights=e.getMetaData("componentWeights")||[],!y.weights.length))for(var t=1/y.componentIds.length,n=0,o=y.componentIds.length;o>n;++n)y.weights.push(t);return y.weights}var v={constructor:Monocle.Book},b=v.constants=v.constructor,y=v.properties={dataSource:e,preloadWindow:t,cmptLoadQueue:{},components:[],chapters:{}};return v.getMetaData=e.getMetaData,v.pageNumberAt=o,v.setPageAt=r,v.loadPageAt=i,v.setOrLoadPageAt=a,v.chaptersForComponent=f,v.locusOfChapter=p,v.isValidLocus=h,v.componentWeights=g,n(),v},Monocle.Book.fromNodes=function(e){return console.deprecation("Book.fromNodes() will soon be removed."),new Monocle.Book(Monocle.bookDataFromNodes(e))},Monocle.Book.PRELOAD_INTERVAL=1e3,Monocle.Place=function(){function e(e,t){g.component=e,g.percent=t/e.lastPageNumber(),g.chapter=null}function t(e,t){g.component=e,g.percent=t,g.chapter=null}function n(){return g.component.properties.id}function o(){return g.percent-1/g.component.lastPageNumber()}function r(){return g.percent}function i(e){return Math.max(Math.round(g.component.lastPageNumber()*e),1)}function a(){return i(g.percent)}function s(){return g.component.lastPageNumber()}function c(){return g.chapter?g.chapter:g.chapter=g.component.chapterForPage(a())}function l(){var e=c();return e?e.title:null}function u(){var e=n(),t=c();return t&&t.fragment&&(e+="#"+t.fragment),e}function d(e){e=e||{};var t={page:a(),componentId:n()};return e.direction?t.page+=e.direction:t.percent=r(),t}function f(){var e=g.component.properties.book;e.properties.componentIds;for(var t=e.componentWeights(),n=g.component.properties.index,o=t[n]*g.percent,r=0,i=n;i>r;++r)o+=t[r];return o}function p(){return 0==g.component.properties.index&&1==a()}function h(){return g.component.properties.index==g.component.properties.book.properties.lastCIndex&&a()==g.component.lastPageNumber()}var m={constructor:Monocle.Place};m.constants=m.constructor;var g=m.properties={component:null,percent:null};return m.setPlace=e,m.setPercentageThrough=t,m.componentId=n,m.percentAtTopOfPage=o,m.percentAtBottomOfPage=r,m.percentageThrough=r,m.pageAtPercentageThrough=i,m.pageNumber=a,m.pagesInComponent=s,m.chapterInfo=c,m.chapterTitle=l,m.chapterSrc=u,m.getLocus=d,m.percentageOfBook=f,m.onFirstPageOfBook=p,m.onLastPageOfBook=h,m},Monocle.Place.FromPageNumber=function(e,t){var n=new Monocle.Place;return n.setPlace(e,t),n},Monocle.Place.FromPercentageThrough=function(e,t){var n=new Monocle.Place;return n.setPercentageThrough(e,t),n},Monocle.Place.percentOfBookToLocus=function(e,t){var n=e.getBook(),o=n.properties.componentIds,r=n.componentWeights(),i=0,a=0;for(t=Math.min(t,.99999);t>=0;)if(a=r[i],t-=r[i],t>=0&&(i+=1,i>=r.length))return console.error("Unable to calculate locus from percentage: "+t),void 0;var s=(t+a)/a;return{componentId:o[i],percent:s}},Monocle.Component=function(e,t,n,o,r){function i(e,t){y(e.m.reader);var n={page:e,source:E.source};e.m.reader.dispatchEvent("monocle:componentchanging",n);var o=function(){u(e,e.m.activeFrame,function(){t(e,k)})};Monocle.defer(function(){a(e,o)})}function a(e,t){var n=e.m.activeFrame;return n.m.component=k,n.style.visibility="hidden",n.whenDocumentReady=function(){var t=n.contentDocument,o={page:e,document:t,component:k};e.m.reader.dispatchEvent("monocle:componentmodify",o),n.whenDocumentReady=null},E.source.html?s(E.source.html||E.source,n,t):E.source.url?c(E.source.url,n,t):E.source.doc?l(E.source.doc,n,t):void 0}function s(e,t,n){var o=function(){Monocle.Events.deafen(t,"load",o),Monocle.defer(n)};Monocle.Events.listen(t,"load",o),t.contentDocument.open("text/html","replace"),t.contentDocument.write(e),t.contentDocument.close(),t.whenDocumentReady()}function c(e,t,n){e.match(/^\//)||(e=M(e));var o=function(){Monocle.Events.deafen(t,"load",o),t.whenDocumentReady()},r=function(){Monocle.Events.deafen(t,"load",r),Monocle.defer(n)};Monocle.Events.listen(t,"load",o),Monocle.Events.listen(t,"load",r),t.contentWindow.location.replace(e)}function l(e,t,n){var o=t.contentDocument;if(Monocle.Browser.is.WebKit){var r=e.querySelector("base");if(r){var i=o.querySelector("head");if(!i)try{i=o.createElement("head"),S(o.documentElement,i)}catch(a){i=o.body}var s=o.createElement("base");s.setAttribute("href",r.href),i.appendChild(s)}}o.replaceChild(o.importNode(e.documentElement,!0),o.documentElement),Monocle.defer(n)}function u(e,t,n){d(e,function(){t.style.visibility="visible",f(e);var o=t.contentDocument,r={page:e,document:o,component:k};e.m.reader.dispatchEvent("monocle:componentchange",r),n()})}function d(e,t){e.m.dimensions.update(function(e){E.pageLength=e,"function"==typeof t&&t()})}function f(e){if(!E.chapters[0]||"number"!=typeof E.chapters[0].percent){for(var t=e.m.activeFrame.contentDocument,n=0;n<E.chapters.length;++n){var o=E.chapters[n];if(o.percent=0,o.fragment){var r=t.getElementById(o.fragment);o.percent=e.m.dimensions.percentageThroughOfNode(r)}}return E.chapters}}function p(e){for(var t=null,n=(e-1)/E.pageLength,o=0;o<E.chapters.length;++o){if(!(n>=E.chapters[o].percent))return t;t=E.chapters[o]}return t}function h(e,t){if(!e)return 1;for(var n=0;n<E.chapters.length;++n)if(E.chapters[n].fragment==e)return v(E.chapters[n].percent);var o=t.m.activeFrame.contentDocument,r=o.getElementById(e),i=t.m.dimensions.percentageThroughOfNode(r);return v(i)}function m(e,t){var n=t.m.activeFrame.contentDocument,o=0;if(Monocle.Browser.env.supportsXPath){var r=n.evaluate(e,n,null,9,null).singleNodeValue;r&&(o=t.m.dimensions.percentageThroughOfNode(r))}else console.warn("XPath not supported in this client.");return v(o)}function g(e,t){var n=t.m.activeFrame.contentDocument,o=0;if(Monocle.Browser.env.supportsQuerySelector){var r=n.querySelector(e);r&&(o=t.m.dimensions.percentageThroughOfNode(r))}else console.warn("querySelector not supported in this client.");return v(o)}function v(e){return Math.floor(e*E.pageLength)+1}function b(){return E.pageLength}function y(e){if(!E.sourcePrepared){if(E.sourcePrepared=!0,"string"==typeof E.source&&(E.source={html:E.source}),E.source.javascript){console.deprecation("Loading a component by 'javascript' is deprecated. Use { 'html': src } -- no need to escape or clean the string.");var t=E.source.javascript;t=t.replace(/\\n/g,"\n"),t=t.replace(/\\r/g,"\r"),t=t.replace(/\\'/g,"'"),E.source={html:t}}if(E.source.nodes){for(var n=[],o=0,r=E.source.nodes.length;r>o;++o){var i=E.source.nodes[o];if(i.outerHTML)n.push(i.outerHTML);else{var a=document.createElement("div");a.appendChild(i.cloneNode(!0)),n.push(a.innerHTML),delete a}}E.source={html:n.join("")}}if(E.source.html&&!E.source.html.match(new RegExp("<bases.+>","im"))){var s=w(e);s&&(E.source.html=E.source.html.replace(new RegExp("(<head(s[^>]*>)|>)","im"),'$1<base href="'+s+'" />'))}if(E.source.doc&&!E.source.doc.querySelector("base")){var c=E.source.doc.querySelector("head")||E.source.doc.body,s=w(e);if(c&&s){var l=E.source.doc.createElement("base");l.setAttribute("href",s),S(c,l)}}}}function w(e){var t={cmptId:E.id,cmptURI:M(E.id)};return e.dispatchEvent("monocle:component:baseuri",t,!0)?t.cmptURI:void 0}function M(e){var t=document.createElement("a");return t.setAttribute("href",e),result=t.href,delete t,result}function S(e,t){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)}var k={constructor:Monocle.Component};k.constants=k.constructor;var E=k.properties={book:e,id:t,index:n,chapters:o,source:r};return k.applyTo=i,k.updateDimensions=d,k.chapterForPage=p,k.pageForChapter=h,k.pageForXPath=m,k.pageForSelector=g,k.lastPageNumber=b,k},Monocle.Selection=function(e){function t(){d.SELECTION_POLLING_INTERVAL&&setInterval(n,d.SELECTION_POLLING_INTERVAL)}function n(){for(var t=0,n=null;n=e.dom.find("component",t++);)n.contentWindow&&o(n.contentWindow,t)}function o(e,t){var n=e.getSelection(),o=f.lastSelection[t]||{},i=f.lastSelection[t]={selected:l(e),range:n.rangeCount?n.getRangeAt(0):null,string:n.toString()};i.selected?(i.rangeStartContainer=i.range.startContainer,i.rangeEndContainer=i.range.endContainer,i.rangeStartOffset=i.range.startOffset,i.rangeEndOffset=i.range.endOffset,r(i,o)||f.reader.dispatchEvent("monocle:selection",i)):o.selected&&f.reader.dispatchEvent("monocle:deselection",o)}function r(e,t){return e.rangeStartContainer==t.rangeStartContainer&&e.rangeEndContainer==t.rangeEndContainer&&e.rangeStartOffset==t.rangeStartOffset&&e.rangeEndOffset==t.rangeEndOffset}function i(){for(var t=0,n=null;n=e.dom.find("component",t++);)a(n.contentWindow)}function a(e){if(e=e||window,l(e)){Monocle.Browser.iOSVersion&&!Monocle.Browser.iOSVersionBelow(5)&&c(function(){s(function(){var e=document.createElement("input");e.style.cssText=["position: absolute","top: 0","left: 0","width: 0","height: 0"].join(";"),document.body.appendChild(e),e.focus(),document.body.removeChild(e)})});var t=e.getSelection();t.removeAllRanges(),e.document.body.scrollLeft=0,e.document.body.scrollTop=0}}function s(e){var t=window.scrollX,n=window.scrollY;e(),window.scrollTo(t,n)}function c(e){var t=document.querySelector("head"),n=t.querySelector("meta[name=viewport]"),o=function(e){var n=document.createElement("meta");return n.setAttribute("name","viewport"),n.setAttribute("content",e),t.appendChild(n),n};if(n){var r=n.getAttribute("content"),i=/user-scalable\s*=\s*([^,$\s])*/,a=r.match(i);if(a&&["no","0"].indexOf(a[1])>=0)e();else{var s=r.replace(i,"");s+=s?", ":"",s+="user-scalable=no",t.removeChild(n);var c=o(s);e(),t.removeChild(c),t.appendChild(n)}}else{var c=o("user-scalable=no");e(),c.setAttribute("content","user-scalable=yes")}}function l(e){return!e.getSelection().isCollapsed}var u={constructor:Monocle.Selection},d=u.constants=u.constructor,f=u.properties={reader:e,lastSelection:[]};return u.deselect=i,t(),u},Monocle.Selection.SELECTION_POLLING_INTERVAL=250,Monocle.Billboard=function(e){function t(t,i){if(l.reader.dispatchEvent("monocle:modal:on"),l.cntr)return console.warn("Modal billboard already showing.");var i=i||{},s=t;if(l.cntr=e.dom.append("div",c.CLS.cntr),"string"==typeof t){var u=t;l.inner=s=l.cntr.dom.append("iframe",c.CLS.inner),s.setAttribute("src",u)}else l.inner=l.cntr.dom.append("div",c.CLS.inner),l.inner.appendChild(s);if(l.dims=[s.naturalWidth||s.offsetWidth,s.naturalHeight||s.offsetHeight],0!=i.closeButton){var d=l.cntr.dom.append("div",c.CLS.closeButton);Monocle.Events.listenForTap(d,n)}a(i.align||"left top"),l.reader.listen("monocle:resize",a),r(i.from),Monocle.defer(o)}function n(){r(),Monocle.Events.afterTransition(l.cntr,i)}function o(){Monocle.Styles.transitionFor(l.cntr,"transform",c.ANIM_MS,"ease-in"),Monocle.Styles.affix(l.cntr,"transform","translate(0, 0) scale(1)")}function r(e){l.from=e||l.from||[0,0];var t=l.from[0]+"px",n=l.from[1]+"px";Monocle.Styles.affix(l.cntr,"transform","translate("+t+","+n+") scale(0)")}function i(){l.cntr.parentNode.removeChild(l.cntr),l.cntr=l.inner=null,l.reader.deafen("monocle:resize",a),l.reader.dispatchEvent("monocle:modal:off")}function a(e){if(l.alignment="string"==typeof e?e:l.alignment,l.alignment){l.dims[0]>l.inner.offsetWidth||l.dims[1]>l.inner.offsetHeight?l.cntr.dom.addClass(c.CLS.oversized):l.cntr.dom.removeClass(c.CLS.oversized);var t=l.alignment.split(/\s+/),n=0,o=0,r=l.inner.scrollWidth-l.inner.offsetWidth,i=l.inner.scrollHeight-l.inner.offsetHeight;t[0].match(/^\d+$/)?n=Math.max(0,parseInt(t[0])-l.inner.offsetWidth/2):"center"==t[0]?n=r/2:"right"==t[0]&&(n=r),t[1]&&t[1].match(/^\d+$/)?o=Math.max(0,parseInt(t[1])-l.inner.offsetHeight/2):t[1]&&"center"!=t[1]?"bottom"==t[1]&&(o=i):o=i/2,l.inner.scrollLeft=n,l.inner.scrollTop=o}}var s={constructor:Monocle.Billboard},c=s.constants=s.constructor,l=s.properties={reader:e,cntr:null};return s.show=t,s.hide=n,s.align=a,s},Monocle.Billboard.CLS={cntr:"billboard_container",inner:"billboard_inner",closeButton:"billboard_close",oversized:"billboard_oversized"},Monocle.Billboard.ANIM_MS=400,Monocle.Controls.Panel=function(){function e(e){return p.div=e.dom.make("div",f.CLS.panel),p.div.dom.setStyles(f.DEFAULT_STYLES),Monocle.Events.listenForContact(p.div,{start:r,move:i,end:a,cancel:s},{useCapture:!1}),p.div}function t(e){p.direction=e}function n(e){p.evtCallbacks=e}function o(){p.evtCallbacks={}}function r(e){p.contact=!0,e.m.offsetX+=p.div.offsetLeft,e.m.offsetY+=p.div.offsetTop,l(),c("start",e)}function i(e){p.contact&&c("move",e)}function a(e){p.contact&&(Monocle.Events.deafenForContact(p.div,p.listeners),u(),p.contact=!1,c("end",e))}function s(e){p.contact&&(Monocle.Events.deafenForContact(p.div,p.listeners),u(),p.contact=!1,c("cancel",e))}function c(e,t){p.evtCallbacks[e]&&p.evtCallbacks[e](p.direction,t.m.offsetX,t.m.offsetY,d),t.preventDefault()}function l(){p.expanded||(p.div.dom.addClass(f.CLS.expanded),p.expanded=!0)}function u(){p.expanded&&(p.div.dom.removeClass(f.CLS.expanded),p.expanded=!1)}var d={constructor:Monocle.Controls.Panel},f=d.constants=d.constructor,p=d.properties={evtCallbacks:{}};return d.createControlElements=e,d.listenTo=n,d.deafen=o,d.expand=l,d.contract=u,d.setDirection=t,d},Monocle.Controls.Panel.CLS={panel:"panel",expanded:"controls_panel_expanded"},Monocle.Controls.Panel.DEFAULT_STYLES={position:"absolute",height:"100%"},Monocle.Panels.TwoPane=function(e,t){function n(){i.panels={forwards:new Monocle.Controls.Panel,backwards:new Monocle.Controls.Panel};for(dir in i.panels){e.properties.reader.addControl(i.panels[dir]),i.panels[dir].listenTo(t),i.panels[dir].setDirection(e.constants[dir.toUpperCase()]);var n={width:r.WIDTH};n["forwards"==dir?"right":"left"]=0,i.panels[dir].properties.div.dom.setStyles(n)}}var o={constructor:Monocle.Panels.TwoPane},r=o.constants=o.constructor,i=o.properties={};return n(),o},Monocle.Panels.TwoPane.WIDTH="50%",Monocle.Panels.IMode=function(e,t){function n(){d.flipper=e,d.reader=e.properties.reader,d.panels={forwards:new Monocle.Controls.Panel,backwards:new Monocle.Controls.Panel},d.divs={};for(dir in d.panels)d.reader.addControl(d.panels[dir]),d.divs[dir]=d.panels[dir].properties.div,d.panels[dir].listenTo(t),d.panels[dir].setDirection(e.constants[dir.toUpperCase()]),d.divs[dir].style.width="33%",d.divs[dir].style["forwards"==dir?"right":"left"]=0;d.panels.central=new Monocle.Controls.Panel,d.reader.addControl(d.panels.central),d.divs.central=d.panels.central.properties.div,d.divs.central.dom.setStyles({left:"33%",width:"34%"}),o({end:i});for(dir in d.panels)d.divs[dir].dom.addClass("panels_imode_panel"),d.divs[dir].dom.addClass("panels_imode_"+dir+"Panel");d.toggleIcon={createControlElements:function(e){var t=e.dom.make("div","panels_imode_toggleIcon");return Monocle.Events.listenForTap(t,a),t}},d.reader.addControl(d.toggleIcon,null,{hidden:!0})}function o(e){d.menuCallbacks=e,d.panels.central.listenTo(d.menuCallbacks)}function r(){d.interactive?a():i()}function i(){if(!d.interactive){d.panels.central.contract();var t=d.reader.visiblePages()[0],n=t.m.sheafDiv,o=n.offsetLeft,r=t.offsetWidth-(n.offsetLeft+n.offsetWidth);o=Math.floor(1e4*((o-2)/t.offsetWidth)/100)+"%",r=Math.floor(1e4*((r-2)/t.offsetWidth)/100)+"%",s(function(){d.divs.forwards.style.width=r,d.divs.backwards.style.width=o,Monocle.Styles.affix(d.divs.central,"transform","translateY(-100%)")}),d.reader.showControl(d.toggleIcon),d.interactive=!0,e.interactiveMode&&e.interactiveMode(!0)}}function a(){d.interactive&&(d.panels.central.contract(),d.reader.selection.deselect(),s(function(){d.divs.forwards.style.width="33%",d.divs.backwards.style.width="33%",Monocle.Styles.affix(d.divs.central,"transform","translateY(0)")}),d.reader.hideControl(d.toggleIcon),d.interactive=!1,e.interactiveMode&&e.interactiveMode(!1))}function s(e){var t=Monocle.Panels.IMode.CAMEO_DURATION+"ms ease-in";Monocle.Styles.affix(d.divs.forwards,"transition","width "+t),Monocle.Styles.affix(d.divs.backwards,"transition","width "+t),Monocle.Styles.affix(d.divs.central,"transition","-webkit-transform "+t);for(var n in d.panels)d.panels[n].deafen();for(var o in d.divs)d.divs[o].style.opacity=1;"undefined"!=typeof WebkitTransitionEvent?d.cameoListener=Monocle.Events.listen(d.divs.central,"webkitTransitionEnd",c):setTimeout(c,u.CAMEO_DURATION),e()}function c(){setTimeout(function(){var e="opacity linear "+Monocle.Panels.IMode.LINGER_DURATION+"ms";Monocle.Styles.affix(d.divs.forwards,"transition",e),Monocle.Styles.affix(d.divs.backwards,"transition",e),Monocle.Styles.affix(d.divs.central,"transition",e);for(var n in d.divs)d.divs[n].style.opacity=0;d.panels.forwards.listenTo(t),d.panels.backwards.listenTo(t),d.panels.central.listenTo(d.menuCallbacks)},Monocle.Panels.IMode.LINGER_DURATION),d.cameoListener&&Monocle.Events.deafen(d.divs.central,"webkitTransitionEnd",c)}var l={constructor:Monocle.Panels.IMode},u=l.constants=l.constructor,d=l.properties={};return l.toggle=r,l.modeOn=i,l.modeOff=a,l.menuCallbacks=o,n(),l},Monocle.Panels.IMode.CAMEO_DURATION=250,Monocle.Panels.IMode.LINGER_DURATION=250,Monocle.Panels.eInk=function(e,t){function n(){a.panel=new Monocle.Controls.Panel,a.reader=a.flipper.properties.reader,a.reader.addControl(a.panel),a.panel.listenTo({end:function(n,o){o<a.panel.properties.div.offsetWidth/2?a.panel.setDirection(e.constants.BACKWARDS):a.panel.setDirection(e.constants.FORWARDS),t.end(n,o)}});var n=a.panel.properties.div.style;a.reader.listen("monocle:componentchanging",function(){n.opacity=1,Monocle.defer(function(){n.opacity=0},40)}),n.width="100%",n.background="#000",n.opacity=0,i.LISTEN_FOR_KEYS&&Monocle.Events.listen(window.top.document,"keyup",o)}function o(t){var n=t.charCode||t.keyCode,o=null;n==i.KEYS.PAGEUP?o=e.constants.BACKWARDS:n==i.KEYS.PAGEDOWN&&(o=e.constants.FORWARDS),o&&(e.moveTo({direction:o}),t.preventDefault())}var r={constructor:Monocle.Panels.eInk},i=r.constants=r.constructor,a=r.properties={flipper:e};return n(),r},Monocle.Panels.eInk.LISTEN_FOR_KEYS=!0,Monocle.Panels.eInk.KEYS={PAGEUP:33,PAGEDOWN:34},Monocle.Panels.Marginal=function(flipper,evtCallbacks){function initialize(){p.panels={forwards:new Monocle.Controls.Panel,backwards:new Monocle.Controls.Panel};for(dir in p.panels)with(flipper.properties.reader.addControl(p.panels[dir]),p.panels[dir].listenTo(evtCallbacks),p.panels[dir].setDirection(flipper.constants[dir.toUpperCase()]),p.panels[dir].properties.div.style)"forwards"==dir?right=0:left=0;setWidths(),flipper.interactiveMode&&flipper.interactiveMode(!0)}function setWidths(){var e=flipper.properties.reader.dom.find("page"),t=e.m.sheafDiv,n=t.offsetLeft,o=e.offsetWidth-(t.offsetLeft+t.offsetWidth);n=Math.floor(1e4*((n-2)/e.offsetWidth)/100)+"%",o=Math.floor(1e4*((o-2)/e.offsetWidth)/100)+"%",p.panels.forwards.properties.div.style.width=o,p.panels.backwards.properties.div.style.width=n}var API={constructor:Monocle.Panels.Marginal};API.constants=API.constructor;var p=API.properties={};return API.setWidths=setWidths,initialize(),API},Monocle.Panels.Magic=function(e,t){function n(){F.reader=e.properties.reader,F.parts={reader:F.reader.dom.find("box"),cmpts:[]};for(var t=0;t<F.flipper.pageCount;++t)F.parts.cmpts.push(F.reader.dom.find("component",t));o(),F.reader.listen("monocle:componentmodify",o),F.reader.listen("monocle:magic:init",o),F.reader.listen("monocle:magic:halt",r),F.reader.listen("monocle:modal:on",i),F.reader.listen("monocle:modal:off",a)}function o(){c(),s()}function r(){c()}function i(){c(),F.disabled=!0}function a(){F.disabled=!1,s()}function s(){if(!F.disabled&&!F.startListeners.length){F.startListeners.push([F.parts.reader,Monocle.Events.listenForContact(F.parts.reader,{start:b(F.parts.reader,f)})]);for(var e=0,t=F.parts.cmpts.length;t>e;++e)F.startListeners.push([F.parts.cmpts[e].contentDocument.defaultView,Monocle.Events.listenForContact(F.parts.cmpts[e].contentDocument.defaultView,{start:b(F.parts.cmpts[e],m)})])}}function c(){if(!F.disabled&&F.startListeners.length){for(var e=0,t=F.startListeners.length;t>e;++e)Monocle.Events.deafenForContact(F.startListeners[e][0],F.startListeners[e][1]);F.startListeners=[]}}function l(e,t){u(document.defaultView,b(document.documentElement,e),b(document.documentElement,t));for(var n=0,o=F.parts.cmpts.length;o>n;++n)u(F.parts.cmpts[n].contentDocument.defaultView,b(F.parts.cmpts[n],e),b(F.parts.cmpts[n],t))}function u(e,t,n){var o=Monocle.Events.listenForContact(e,{move:t,end:function(e){d(),n(e)}});F.contacts.push([e,o])}function d(){for(var e=0,t=F.contacts.length;t>e;++e)Monocle.Events.deafenForContact(F.contacts[e][0],F.contacts[e][1]);F.contacts=[]}function f(e){l(p,h),F.action.startX=e.m.readerX,F.action.startY=e.m.readerY,F.action.screenX=e.m.screenX,F.action.screenY=e.m.screenY,F.action.dir=e.m.readerX>w()?T.FORWARDS:T.BACKWARDS,E("start",e)}function p(e){E("move",e),e.preventDefault()}function h(e){F.action.endX=e.m.readerX,F.action.endY=e.m.readerY,E("end",e),F.action={}}function m(e){return S(e)?M():(F.action.startX=e.m.readerX,F.action.startY=e.m.readerY,F.action.screenX=e.m.screenX,F.action.screenY=e.m.screenY,l(g,v),void 0)}function g(e){return k()?void 0:S(e)?M():(e.preventDefault(),void 0)}function v(e){if(!k()){if(S(e))return M();F.action.endX=e.m.readerX,F.action.endY=e.m.readerY,F.action.dir=Math.abs(F.action.endX-F.action.startX)<T.LEEWAY?F.action.startX>w()?T.FORWARDS:T.BACKWARDS:F.action.startX>F.action.endX?T.FORWARDS:T.BACKWARDS;var t=F.parts.reader.getBoundingClientRect(),n={start:{x:F.action.startX,y:F.action.startY},end:{x:F.action.endX,y:F.action.endY},max:{x:t.right-t.left,y:t.bottom-t.top}};F.reader.dispatchEvent("monocle:magic:contact",n,!0)&&(E("start",e),E("end",e)),F.action={}}}function b(e,t){return function(n){y(e,n,t)}}function y(e,t,n){if("undefined"!=typeof F.action.screenX)t.m.readerX=F.action.startX+(t.m.screenX-F.action.screenX),t.m.readerY=F.action.startY+(t.m.screenY-F.action.screenY);else{var o=document.documentElement.getBoundingClientRect(),r=F.parts.reader.getBoundingClientRect();if(r={left:r.left-o.left,top:r.top-o.top},t.view==window)t.m.readerX=Math.round(t.m.pageX-r.left),t.m.readerY=Math.round(t.m.pageY-r.top);else{var i=e.getBoundingClientRect();i={left:i.left-o.left,top:i.top-o.top},t.m.readerX=Math.round(i.left-r.left+t.m.clientX),t.m.readerY=Math.round(i.top-r.top+t.m.clientY)}}n(t)}function w(){return F.parts.reader.offsetWidth/2}function M(){F.action={},d()}function S(e){var t=e.target.ownerDocument.defaultView;return e.defaultPrevented||!t.getSelection().isCollapsed}function k(){return"undefined"==typeof F.action.startX}function E(e,t){F.evtCallbacks[e]&&F.evtCallbacks[e](F.action.dir,t.m.readerX,t.m.readerY,C)}var C={constructor:Monocle.Panels.Magic},T=C.constants=C.constructor,F=C.properties={flipper:e,evtCallbacks:t,parts:{},action:{},contacts:[],startListeners:[],disabled:!1};return C.enable=a,C.disable=i,n(),C},Monocle.Panels.Magic.LEEWAY=3,Monocle.Panels.Magic.FORWARDS=1,Monocle.Panels.Magic.BACKWARDS=-1,Monocle.Dimensions.Columns=function(e){function t(e){n(),Monocle.defer(function(){h.length=a(),Monocle.DEBUG&&console.log("page["+h.page.m.pageIndex+"] -> "+h.length+" ("+h.page.m.activeFrame.m.component.properties.id+")"),e(h.length)})}function n(){var e=i(),t=o();h.width=e.width;var n=Monocle.Styles.rulesToString(p.STYLE.columned);n+=Monocle.Browser.css.toCSSDeclaration("column-width",e.col+"px"),n+=Monocle.Browser.css.toCSSDeclaration("column-gap",p.GAP+"px"),n+=Monocle.Browser.css.toCSSDeclaration("column-fill","auto"),n+=Monocle.Browser.css.toCSSDeclaration("transform","translateX(0)"),Monocle.Browser.env.forceColumns&&t.scrollHeight>e.height&&(n+=Monocle.Styles.rulesToString(p.STYLE["column-force"]),Monocle.DEBUG&&console.warn("Force columns ("+t.scrollHeight+" > "+e.height+")")),t.style.cssText!=n&&(h.page.m.offset=0,Monocle.Browser.env.documentElementHasScrollbars&&(t.ownerDocument.documentElement.style.overflow="hidden"),t.style.cssText=n,Monocle.Browser.env.scrollToApplyStyle&&(t.scrollLeft=0))}function o(){return h.page.m.activeFrame.contentDocument.body}function r(){var e=o(),t=h.page.m.activeFrame.contentDocument.documentElement,n=Math.max(e.scrollWidth,t.scrollWidth);return!Monocle.Browser.env.widthsIgnoreTranslate&&h.page.m.offset&&(n+=h.page.m.offset),n}function i(){var e=h.page.m.sheafDiv,t=e.clientWidth;return e.getBoundingClientRect&&(t=e.getBoundingClientRect().width),Monocle.Browser.env.roundPageDimensions&&(t=Math.round(t)),{col:t,width:t+p.GAP,height:e.clientHeight}}function a(){return Math.ceil(r()/i().width)}function c(e){return i().width*(e.page-1)}function l(e,t){var n=c(e);return h.page.m.offset=n,u(n,t),n}function u(e,t){var n=o();t&&Monocle.Styles.affix(n,"transition",t),Monocle.Styles.affix(n,"transform","translateX(-"+e+"px)")}function d(e){if(!e)return 0;var t=h.page.m.activeFrame.contentDocument,n=0;if(Monocle.Browser.env.findNodesByScrolling){u(0);var o=s=h.page.m.activeFrame.contentWindow,r=[[o,o.scrollX,o.scrollY],[window,window.scrollX,window.scrollY]];if(Monocle.Browser.env.sheafIsScroller){var i=h.page.m.sheafDiv;i.scrollLeft,e.scrollIntoView(),n=i.scrollLeft}else{var i=o;i.scrollX,e.scrollIntoView(),n=i.scrollX}for(;s=r.shift();)s[0].scrollTo(s[1],s[2]);u(h.page.m.offset)}else n=e.getBoundingClientRect().left,n-=t.body.getBoundingClientRect().left;n+=1;var a=n/(h.length*h.width);return a}var f={constructor:Monocle.Dimensions.Columns},p=f.constants=f.constructor,h=f.properties={page:e,reader:e.m.reader,length:0,width:0};return p.GAP=Monocle.Browser.env.forceColumns?0:20,f.update=t,f.percentageThroughOfNode=d,f.locusToOffset=c,f.translateToLocus=l,f},Monocle.Dimensions.Columns.STYLE={columned:{margin:"0",padding:"0",height:"100%",width:"100%",position:"absolute"},"column-force":{"min-width":"200%",overflow:"hidden"}},Monocle.Flippers.Slider=function(e){function t(){j.reader.listen("monocle:componentchanging",O)}function n(e){e.m.dimensions=new Monocle.Dimensions.Columns(e),Monocle.Styles.setX(e,0)}function o(){return[l()]}function r(e){i(!0),i(!1),"function"!=typeof e&&(e=W.DEFAULT_PANELS_CLASS,e||console.warn("Invalid panel class.")),j.panels=new e(N,{start:f,move:p,end:h,cancel:h})}function i(e){j.reader.dispatchEvent("monocle:interactive:"+(e?"on":"off"))}function a(e){return e=e||l(),e.m?e.m.place:null}function s(e,t){var n=function(){S(function(){"function"==typeof t&&t(),E()})};c(l(),e,n)}function c(e,t,n){j.reader.getBook().setOrLoadPageAt(e,t,function(t){e.m.dimensions.translateToLocus(t),Monocle.defer(n)})}function l(){return j.reader.dom.find("page",j.activeIndex)}function u(){return j.reader.dom.find("page",(j.activeIndex+1)%2)}function d(){return l().style.zIndex=1,u().style.zIndex=2,j.activeIndex=(j.activeIndex+1)%2}function f(e,t){if(!j.turnData.lifting&&!j.turnData.releasing){j.reader.selection.deselect(),j.turnData.points={start:t,min:t,max:t},j.turnData.lifting=!0;var n=a();if(e==W.FORWARDS){if(n.onLastPageOfBook())return j.reader.dispatchEvent("monocle:boundaryend",{locus:a().getLocus({direction:e}),page:l()}),T(),void 0;g(t)}else if(e==W.BACKWARDS){if(n.onFirstPageOfBook())return j.reader.dispatchEvent("monocle:boundarystart",{locus:a().getLocus({direction:e}),page:l()}),T(),void 0;v(t)}else console.warn("Invalid direction: "+e)}}function p(e,t){j.turnData.points&&(j.turnData.lifting||j.turnData.releasing||(m(t),I(t,null,"0")))}function h(e,t){return j.turnData.points?j.turnData.lifting?(j.turnData.releaseArgs=[e,t],void 0):(j.turnData.releasing||(m(t),j.turnData.releasing=!0,e==W.FORWARDS?j.turnData.points.tap||j.turnData.points.start-t>60||j.turnData.points.min>=t?D(b):P(w):e==W.BACKWARDS?j.turnData.points.tap||t-j.turnData.points.start>60||j.turnData.points.max<=t?P(y):D(M):console.warn("Invalid direction: "+e)),void 0):void 0}function m(e){j.turnData.points.min=Math.min(j.turnData.points.min,e),j.turnData.points.max=Math.max(j.turnData.points.max,e),j.turnData.points.tap=j.turnData.points.max-j.turnData.points.min<10}function g(e){k(e)}function v(e){var t=u(),n=l();Monocle.Browser.env.offscreenRenderingClipped?c(t,a(n).getLocus({direction:W.BACKWARDS}),function(){d(),A(t,function(){k(e)})}):A(t,function(){d(),c(t,a(n).getLocus({direction:W.BACKWARDS}),function(){k(e)})})}function b(){var e=l();u(),j.interactive?c(e,a().getLocus({direction:W.FORWARDS}),function(){x(e,function(){S(E)})}):(d(),x(e,function(){S(E)}))}function y(){j.interactive?c(u(),a().getLocus(),function(){d(),S(E)}):E()}function w(){C()}function M(){d(),x(u(),function(){S(C)})}function S(e){c(u(),a().getLocus({direction:W.FORWARDS}),e)}function k(e){j.turnData.lifting=!1,j.reader.dispatchEvent("monocle:turning");var t=j.turnData.releaseArgs;t?(j.turnData.releaseArgs=null,h(t[0],t[1])):e&&I(e)}function E(){j.reader.dispatchEvent("monocle:turn"),T()}function C(){j.reader.dispatchEvent("monocle:turn:cancel"),T()}function T(){R(),j.turnData={}}function F(e,t,n,o){var r;if(r=n.duration?parseInt(n.duration):0,Monocle.Browser.env.supportsTransition)Monocle.Styles.transitionFor(e,"transform",r,n.timing,n.delay),Monocle.Browser.env.supportsTransform3d?Monocle.Styles.affix(e,"transform","translate3d("+t+"px,0,0)"):Monocle.Styles.affix(e,"transform","translateX("+t+"px)"),"function"==typeof o&&(r&&Monocle.Styles.getX(e)!=t?Monocle.Events.afterTransition(e,o):Monocle.defer(o));else{e.currX=e.currX||0;var i=function(){e.currX=t,Monocle.Styles.setX(e,t),"function"==typeof o&&o()};if(r){var a=(new Date).getTime(),s=40,c=(t-e.currX)*(s/r),l=function(){var n=e.currX+c,o=(new Date).getTime()-a>=r,u=n>t&&e.currX<t||t>n&&e.currX>t;o||u?i():(Monocle.Styles.setX(e,n),e.currX=n,setTimeout(l,s))};l()}else i()}}function x(e,t){opts={duration:Monocle.Browser.env.stickySlideOut?1:0},F(e,0,opts,t)}function A(e,t){F(e,0-e.offsetWidth,{duration:0},t)}function P(e){F(l(),0,L(),e)}function D(e){F(l(),0-l().offsetWidth,L(),e)}function I(e,t,n){F(l(),Math.min(0,e-l().offsetWidth),{duration:n||W.FOLLOW_DURATION},t)}function L(){var e={timing:"ease-in",duration:320},t=(new Date).getTime();return j.lastSlide&&t-j.lastSlide<1500&&(e.duration*=.5),j.lastSlide=t,e}function B(){j.waitControl||(j.waitControl={createControlElements:function(e){return e.dom.make("div","flippers_slider_wait")}},j.reader.addControl(j.waitControl,"page"))}function O(){B(),j.reader.dom.find("flippers_slider_wait",0).style.opacity=1,j.reader.dom.find("flippers_slider_wait",1).style.opacity=1}function R(){B(),j.reader.dom.find("flippers_slider_wait",0).style.opacity=0,j.reader.dom.find("flippers_slider_wait",1).style.opacity=0}var N={constructor:Monocle.Flippers.Slider},W=N.constants=N.constructor,j=N.properties={reader:e,pageCount:2,activeIndex:1,turnData:{}};return N.pageCount=j.pageCount,N.addPage=n,N.getPlace=a,N.moveTo=s,N.listenForInteraction=r,N.visiblePages=o,N.interactiveMode=i,t(),N},Monocle.Flippers.Slider.DEFAULT_PANELS_CLASS=Monocle.Panels.TwoPane,Monocle.Flippers.Slider.FORWARDS=1,Monocle.Flippers.Slider.BACKWARDS=-1,Monocle.Flippers.Slider.FOLLOW_DURATION=100,Monocle.Flippers.Scroller=function(e,t){function n(){p.reader=e,p.setPageFn=t
}function o(e){e.m.dimensions=new Monocle.Dimensions.Columns(e)}function r(){return p.reader.dom.find("page")}function i(e){"function"!=typeof e&&(e=f.DEFAULT_PANELS_CLASS),p.panels=new e(d,{end:a})}function a(e){p.turning||(p.reader.selection.deselect(),c({page:s().pageNumber()+e}),p.reader.dispatchEvent("monocle:turning"))}function s(){return r().m.place}function c(e,t){var n=l;"function"==typeof t&&(n=function(e){l(e),t(e)}),p.reader.getBook().setOrLoadPageAt(r(),e,n)}function l(e){if(!e.boundarystart&&!e.boundaryend){p.turning=!0;var t=r().m.dimensions,n=r().m.activeFrame,o=n.contentDocument.body;if(p.activeComponent!=n.m.component)p.activeComponent=n.m.component,t.translateToLocus(e,"none"),Monocle.defer(u);else if(Monocle.Browser.env.supportsTransition)t.translateToLocus(e,p.duration+"ms ease-in 0ms"),Monocle.Events.afterTransition(o,u);else{var i=t.locusToOffset(e),a=0-i,s=(new Date).getTime(),c=40,l=p.currX||0,d=(a-l)*(c/p.duration),f=function(){var e=l+d;(new Date).getTime()-s>p.duration||Math.abs(l-a)<=Math.abs(l+d-a)?(Monocle.Styles.setX(o,a),u()):(Monocle.Styles.setX(o,e),l=e,setTimeout(f,c)),p.currX=e};f()}}}function u(){p.turning=!1,p.reader.dispatchEvent("monocle:turn")}var d={constructor:Monocle.Flippers.Scroller},f=d.constants=d.constructor,p=d.properties={pageCount:1,duration:300};return d.pageCount=p.pageCount,d.addPage=o,d.getPlace=s,d.moveTo=c,d.listenForInteraction=i,n(),d},Monocle.Flippers.Scroller.speed=200,Monocle.Flippers.Scroller.rate=20,Monocle.Flippers.Scroller.FORWARDS=1,Monocle.Flippers.Scroller.BACKWARDS=-1,Monocle.Flippers.Scroller.DEFAULT_PANELS_CLASS=Monocle.Panels.TwoPane,Monocle.Flippers.Instant=function(e){function t(){d.reader=e}function n(e){e.m.dimensions=new Monocle.Dimensions.Columns(e)}function o(){return a().m.place}function r(e,t){var n=c;"function"==typeof t&&(n=function(e){c(e),t(e)}),d.reader.getBook().setOrLoadPageAt(a(),e,n)}function i(e){if("function"!=typeof e&&(Monocle.Browser.on.Kindle3&&(e=Monocle.Panels.eInk),e=e||u.DEFAULT_PANELS_CLASS),!e)throw"Panels not found.";d.panels=new e(l,{end:s})}function a(){return d.reader.dom.find("page")}function s(e){d.reader.selection.deselect(),r({page:o().pageNumber()+e}),d.reader.dispatchEvent("monocle:turning")}function c(e){a().m.dimensions.translateToLocus(e),Monocle.defer(function(){d.reader.dispatchEvent("monocle:turn")})}var l={constructor:Monocle.Flippers.Instant},u=l.constants=l.constructor,d=l.properties={pageCount:1};return l.pageCount=d.pageCount,l.addPage=n,l.getPlace=o,l.moveTo=r,l.listenForInteraction=i,t(),l},Monocle.Flippers.Instant.FORWARDS=1,Monocle.Flippers.Instant.BACKWARDS=-1,Monocle.Flippers.Instant.DEFAULT_PANELS_CLASS=Monocle.Panels.TwoPane;