"use strict";var AngularFire;angular.module("firebase",[]).value("Firebase",Firebase),angular.module("firebase").factory("angularFire",["$q","$parse","$timeout",function(e,t,n){return function(r,o,i){var a=new AngularFire(e,t,n,r);return a.associate(o,i)}}]),AngularFire=function(e,t,n,r){if(this._q=e,this._parse=t,this._timeout=n,this._initial=!0,this._remoteValue=!1,"string"==typeof r)throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");this._fRef=r},AngularFire.prototype={associate:function(e,t){var n=this,r=this._q.defer(),o=r.promise;return this._fRef.on("value",function(o){var i=o.val(),a=angular.fromJson(angular.toJson(n._parse(t)(e)));if(n._initial){n._initial=!1;var s=!1,c=Object.prototype.toString;if(i&&c.call(a)==c.call(i))if("[object Array]"==c.call(a))s=a.concat(i),angular.equals(s,i)||(n._fRef.ref().set(s),i=s);else if("[object Object]"==c.call(a)){s=a;for(var u in i)s[u]=i[u];n._fRef.ref().update(s),i=s}null===i&&void 0!==a&&(n._fRef.ref().set(a),i=a)}var l=!1;r&&(l=r,r=!1),n._timeout(function(){n._resolve(e,t,l,i)})}),o},disassociate:function(){var e=this;e._unregister&&e._unregister(),this._fRef.off("value")},_resolve:function(e,t,n,r){var o=this;if(null===r){var i=e[t];if("object"==typeof i){var a=Object.prototype.toString;r=a.call(i)==a.call([])?[]:{}}}this._remoteValue=angular.copy(r),this._parse(t).assign(e,angular.copy(r)),n&&(n.resolve(function(){o.disassociate()}),this._watch(e,t))},_watch:function(e,t){var n=this;n._unregister=e.$watch(t,function(){if(!n._initial){var r=angular.fromJson(angular.toJson(n._parse(t)(e)));if(!angular.equals(r,n._remoteValue)){var o=Object.prototype.toString;"[object Object]"==o.call(r)?n._fRef.set?n._fRef.set(r):n._fRef.ref().update(r):n._fRef.ref().set(r)}}},!0),e.$on("$destroy",function(){n.disassociate()})},_log:function(e){console&&console.log&&console.log(e)}},angular.module("firebase").factory("angularFireCollection",["$timeout",function(e){return function(t,n){function r(e){return e?f[e]+1:0}function o(e,t){f[t.$id]=e,d.splice(e,0,t)}function i(e){var t=f[e];d.splice(t,1),f[e]=void 0}function a(e,t){d[e]=t}function s(e,t,n){d.splice(e,1),d.splice(t,0,n),c(e,t)}function c(e,t){var n=d.length;t=t||n,t>n&&(t=n);for(var r=e;t>r;r++){var o=d[r];o.$index=f[o.$id]=r}}if("string"==typeof t)throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");var u=function(e,t){this.$ref=e.ref(),this.$id=e.name(),this.$index=t,angular.extend(this,{$priority:e.getPriority()},e.val())},l=[function(e){return null==e.$priority?0:angular.isNumber(e.$priority)?1:angular.isString(e.$priority)?2:void 0},function(e){return e.$priority?e.$priority:1/0},function(e){return e.$id}],f={},d=[];return n&&"function"==typeof n&&t.once("value",n),t.on("child_added",function(t,n){e(function(){var e=r(n);o(e,new u(t,e)),c(e)})}),t.on("child_removed",function(t){e(function(){var e=t.name(),n=f[e];i(e),c(n)})}),t.on("child_changed",function(t,n){e(function(){var e=f[t.name()],o=r(n),i=new u(t,e);a(e,i),o!==e&&s(e,o,i)})}),t.on("child_moved",function(t,n){e(function(){var e=f[t.name()],o=r(n),i=d[e];s(e,o,i)})}),d.getByName=function(e){return d[f[e]]},d.getByNames=function(e){for(var t=[],n=0,r=e.length;r>n;n++)t.push(d[f[e[n]]]);return t},d.add=function(e,n){var r,o=angular.fromJson(angular.toJson(e));return r=n?t.ref().push(o,n):t.ref().push(o)},d.remove=function(e,t){var n=angular.isString(e)?d[f[e]]:e;t?n.$ref.remove(t):n.$ref.remove()},d.update=function(e,t){var n=angular.isString(e)?d[f[e]]:e,r=angular.fromJson(angular.toJson(n));t?n.$ref.update(r,t):n.$ref.update(r)},d.set=function(e,t){var n=angular.isString(e)?d[f[e]]:e,r=angular.fromJson(angular.toJson(n));t?n.$ref.set(r,t):n.$ref.set(r)},d.order=l,d}}]),angular.module("firebase").factory("angularFireAuth",["$rootScope","$parse","$timeout","$location","$route","$q",function(e,t,n,r,o,i){function a(e){var t=e.split(".");if(!t instanceof Array||3!==t.length)throw new Error("Invalid JWT");var n=t[1];return window.atob?JSON.parse(decodeURIComponent(escape(window.atob(n)))):e}function s(e,r,o,i){r&&n(function(){t(r).assign(e,o),i()})}function c(e,t,n){e.authRequired&&!n._authenticated&&(n._redirectTo=void 0===e.pathTo?r.path():e.pathTo===t?"/":e.pathTo,r.replace(),r.path(t))}return{initialize:function(t,n){var r=this;if("string"==typeof t)throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");if(n=n||{},this._scope=e,!n.scope)throw new Error("Scope not provided to angularFireAuth!");if(this._scope=n.scope,!n.name)throw new Error("Model name not provided to angularFireAuth!");if(this._name=n.name,this._cb=function(){},n.callback&&"function"==typeof n.callback&&(this._cb=n.callback),this._redirectTo=null,this._authenticated=!1,n.path&&(o.current&&c(o.current,n.path,r),e.$on("$routeChangeStart",function(e,t){c(t,n.path,r)})),this._ref=t,n.simple===!1)return s(this._scope,this._name,null,function(){}),void 0;if(!window.FirebaseSimpleLogin){var i=new Error("FirebaseSimpleLogin undefined, did you include firebase-simple-login.js?");return e.$broadcast("angularFireAuth:error",i),void 0}var a=new FirebaseSimpleLogin(this._ref,function(t,n){r._cb(t,n),t?e.$broadcast("angularFireAuth:error",t):n?r._loggedIn(n):r._loggedOut()});this._authClient=a},login:function(t,n){var r=this._watchForLogin();switch(t){case"github":case"persona":case"twitter":case"facebook":case"password":if(this._authClient)this._authClient.login(t,n);else{var o=new Error("Simple Login not initialized");e.$broadcast("angularFireAuth:error",o)}break;default:var i,s=this;try{i=a(t),this._ref.auth(t,function(t){t?e.$broadcast("angularFireAuth:error",t):s._loggedIn(i)})}catch(c){e.$broadcast("angularFireAuth:error",c)}}return r},createUser:function(t,r,o,i){var a=this;this._authClient.createUser(t,r,function(s,c){try{s?e.$broadcast("angularFireAuth:error",s):i||a.login("password",{email:t,password:r})}catch(u){e.$broadcast("angularFireAuth:error",u)}o&&n(function(){o(s,c)})})},logout:function(){this._authClient?this._authClient.logout():(this._ref.unauth(),this._loggedOut())},_loggedIn:function(t){var n=this;this._authenticated=!0,s(this._scope,this._name,t,function(){e.$broadcast("angularFireAuth:login",t),n._redirectTo&&(r.replace(),r.path(n._redirectTo),n._redirectTo=null)})},_loggedOut:function(){this._authenticated=!1,s(this._scope,this._name,null,function(){e.$broadcast("angularFireAuth:logout")})},_watchForLogin:function(){function t(e,t){n(function(){e?o.reject(e):o.resolve(t)});for(var i=0;i<r.length;i++)r[i]()}var r=[],o=i.defer();return r.push(e.$on("angularFireAuth:login",function(e,n){t(null,n)})),r.push(e.$on("angularFireAuth:error",function(e,n){t(n,null)})),o.promise}}}]);